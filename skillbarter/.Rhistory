discard(~ .x == "") |>
discard(~ str_detect(.x, "^\\[[^\\]]+\\]$"))
# Build rows
df_part <- tibble(
track_title = title,
track_n = track_n,
line = seq_along(clean),
lyric = clean
)
rows[[i]] <- df_part
}
df <- bind_rows(rows)
# Write CSV in the same structure as wheredowego.csv
write_csv(df, "songs_about_jane.csv")
df
library(dplyr)
library(readr)
library(stringr)
library(purrr)
library(tibble)
# Read the uploaded file exactly as-is
text <- read_file("songs_about_jane_lyrics.txt")
# Extract track header lines of form: Title NUMBER
header_matches <- str_match_all(
text,
"^([A-Za-z' ]+?)\\s+(\\d+)\\s*$"
)[[1]]
track_titles <- header_matches[,2]
track_titles
track_numbers <- as.integer(header_matches[,3])
track_numbers
# Build regex-safe versions of title+number together
full_headers <- paste0("^", track_titles, "\\s+", track_numbers, "$")
# Split the entire text into lines
lines <- str_split(text, "\n")[[1]]
# Identify which line indexes correspond to headers
header_idx <- which(str_detect(lines, paste0("^(", paste(full_headers, collapse="|"), ")")))
# Add one extra sentinel index for the end of the file
header_idx <- c(header_idx, length(lines)+1)
rows <- list()
for (i in seq_along(track_titles)) {
title <- track_titles[i]
track_n <- track_numbers[i]
start <- header_idx[i] + 1
end <- header_idx[i+1] - 1
song_lines <- lines[start:end]
# Remove empty lines and section labels [Chorus], [Verse], etc.
clean <- song_lines |>
str_trim() |>
discard(~ .x == "") |>
discard(~ str_detect(.x, "^\\[[^\\]]+\\]$"))
# Build rows
df_part <- tibble(
track_title = title,
track_n = track_n,
line = seq_along(clean),
lyric = clean
)
rows[[i]] <- df_part
}
df <- bind_rows(rows)
# Write CSV in the same structure as wheredowego.csv
write_csv(df, "songs_about_jane.csv")
df
library(readr)
library(stringr)
library(dplyr)
library(purrr)
library(tibble)
# Read the file into lines
lines <- readr::read_lines("songs_about_jane_lyrics.txt")
# Extract titles and track numbers from lines that match "Title NUMBER ..."
hm <- stringr::str_match(
lines,
"^(.*?)\\s+(\\d+)\\b"
)
# Rows where the pattern matched
header_rows <- which(!is.na(hm[, 1]))
track_titles  <- hm[header_rows, 2]
track_numbers <- as.integer(hm[header_rows, 3])
track_titles
track_numbers
lines <- read_lines("/mnt/data/songs_about_jane_lyrics.txt")
lines <- read_lines("songs_about_jane_lyrics.txt")
# Match only true track headers: Title (no [ ) + number
hm <- str_match(lines, "^([A-Za-z][A-Za-z' ]+?)\\s+(\\d+)\\b")
header_rows <- which(!is.na(hm[,1]))
track_titles  <- hm[header_rows, 2]
track_numbers <- as.integer(hm[header_rows, 3])
track_titles
track_numbers
header_rows
# Build regex-safe versions of title+number together
full_headers <- paste0("^", track_titles, "\\s+", track_numbers, "$")
# Split the entire text into lines
lines <- str_split(text, "\n")[[1]]
# Identify which line indexes correspond to headers
header_idx <- which(str_detect(lines, paste0("^(", paste(full_headers, collapse="|"), ")")))
# Add one extra sentinel index for the end of the file
header_idx <- c(header_idx, length(lines)+1)
rows <- list()
for (i in seq_along(track_titles)) {
title <- track_titles[i]
track_n <- track_numbers[i]
start <- header_idx[i] + 1
end <- header_idx[i+1] - 1
song_lines <- lines[start:end]
# Remove empty lines and section labels [Chorus], [Verse], etc.
clean <- song_lines |>
str_trim() |>
discard(~ .x == "") |>
discard(~ str_detect(.x, "^\\[[^\\]]+\\]$"))
# Build rows
df_part <- tibble(
track_title = title,
track_n = track_n,
line = seq_along(clean),
lyric = clean
)
rows[[i]] <- df_part
}
df <- bind_rows(rows)
# Write CSV in the same structure as wheredowego.csv
write_csv(df, "songs_about_jane.csv")
df
library(readr)
library(dplyr)
library(stringr)
library(tidyr)
library(purrr)
df <- read_csv("songs_about_jane.csv")
df
df
split_lyric_into_lines <- function(txt) {
# If NA or empty, return character(0)
if (is.na(txt) || txt == "") return(character(0))
# Split on punctuation + space + Capital / [ / "
parts <- str_split(
txt,
"(?<=[\\.!\\?\\)\\]])\\s+(?=[A-Z\\[])"   # lookbehind for punctuation, lookahead for capital or [
)[[1]]
# Trim whitespace
parts <- str_trim(parts)
# Drop any empty strings just in case
parts <- parts[parts != ""]
parts
}
df_lines <- df %>%
mutate(line_vec = map(lyric, split_lyric_into_lines)) %>%
select(track_title, track_n, line_vec) %>%
unnest_longer(line_vec, values_to = "lyric") %>%
group_by(track_title, track_n) %>%
mutate(line = row_number()) %>%
ungroup() %>%
select(track_title, track_n, line, lyric)
# Save as a new CSV
write_csv(df_lines, "songs_about_jane_lines.csv")
library(readr)
library(dplyr)
library(stringr)
library(tidyr)
library(purrr)
df <- read_csv("songs_about_jane.csv")
split_lyric_into_lines <- function(txt) {
if (is.na(txt) || txt == "") return(character(0))
# Split before capital letters, but only if preceded by space
parts <- str_split(
txt,
"\\s+(?=[A-Z])"
)[[1]]
parts <- str_trim(parts)
parts <- parts[parts != ""]
parts
}
df_lines <- df %>%
mutate(line_vec = map(lyric, split_lyric_into_lines)) %>%
select(track_title, track_n, line_vec) %>%
unnest_longer(line_vec, values_to = "lyric") %>%
group_by(track_title, track_n) %>%
mutate(line = row_number()) %>%
ungroup() %>%
select(track_title, track_n, line, lyric)
# Save as a new CSV
write_csv(df_lines, "songs_about_jane_lines.csv")
library(stringr)
## we need to make sure that the lyrics are characters
songsaboutjane$lyric <- as.character(songsaboutjane$lyric)
songsaboutjane <- read.csv("songs_about_jane_lines.csv")
nrc_anger <- get_sentiments("nrc") %>%
filter(sentiment == "anger")
songsaboutjane <- read.csv("songs_about_jane_lines.csv")
nrc_anger <- get_sentiments("nrc") %>%
filter(sentiment == "anger")
library(readr)
library(dplyr)
library(stringr)
library(tidyr)
library(tidytext)
library(textdata)
library(tidyverse)
library(stringr)
library(purrr)
df <- read_csv("songs_about_jane.csv")
split_lyric_into_lines <- function(txt) {
if (is.na(txt) || txt == "") return(character(0))
# Split before capital letters, but only if preceded by space
parts <- str_split(
txt,
"\\s+(?=[A-Z])"
)[[1]]
parts <- str_trim(parts)
parts <- parts[parts != ""]
parts
}
df_lines <- df %>%
mutate(line_vec = map(lyric, split_lyric_into_lines)) %>%
select(track_title, track_n, line_vec) %>%
unnest_longer(line_vec, values_to = "lyric") %>%
group_by(track_title, track_n) %>%
mutate(line = row_number()) %>%
ungroup() %>%
select(track_title, track_n, line, lyric)
# Save as a new CSV
write_csv(df_lines, "songs_about_jane_lines.csv")
songsaboutjane <- read.csv("songs_about_jane_lines.csv")
nrc_anger <- get_sentiments("nrc") %>%
filter(sentiment == "anger")
nrc_anger
library(stringr)
## we need to make sure that the lyrics are characters
songsaboutjane$lyric <- as.character(songsaboutjane$lyric)
tidy_song <- songsaboutjane %>%
group_by(track_title) %>%
ungroup() %>%
unnest_tokens(word,lyric)
tidy_song %>%
filter(track_title == "Harder to Breathe")%>%
inner_join(nrc_anger) %>%
count(word, sort = TRUE)
song_sentiment <- tidy_song %>%
inner_join(get_sentiments("bing")) %>%
count(track_title, index = line, sentiment) %>%
spread(sentiment, n, fill = 0) %>%
mutate(sentiment = positive - negative)
ggplot(song_sentiment, aes(index, sentiment, fill = track_title)) +
geom_col(show.legend = FALSE) +
facet_wrap(~track_title)
afinn <- tidy_song %>%
filter(track_title == "Harder to Breathe") %>%
inner_join(get_sentiments("afinn")) %>%
group_by(index = line) %>%
summarise(sentiment = sum(value)) %>%
mutate(method = "AFINN")
bing_and_nrc <- bind_rows(tidy_song %>%
filter(track_title == "Harder to Breathe") %>%
inner_join(get_sentiments("bing")) %>%
mutate(method = "Bing et al."),
tidy_song %>%
filter(track_title == "Harder to Breathe") %>%
inner_join(get_sentiments("nrc") %>%
filter(sentiment %in% c("positive",
"negative"))) %>%
mutate(method = "NRC")) %>%
count(method, index = line, sentiment) %>%
spread(sentiment, n, fill = 0) %>%
mutate(sentiment = positive - negative)
bind_rows(afinn,
bing_and_nrc) %>%
ggplot(aes(index, sentiment, fill = method)) +
geom_col(show.legend = FALSE) +
facet_wrap(~method, ncol = 1, scales = "free_y")
get_sentiments("nrc") %>%
filter(sentiment %in% c("positive",
"negative")) %>%
count(sentiment)
get_sentiments("bing") %>%
count(sentiment)
bing_word_counts <- tidy_song %>%
inner_join(get_sentiments("bing")) %>%
count(word, sentiment, sort = TRUE) %>%
ungroup()
bing_word_counts
bing_word_counts %>%
group_by(sentiment) %>%
top_n(10) %>%
ungroup() %>%
mutate(word = reorder(word, n)) %>%
ggplot(aes(word, n, fill = sentiment)) +
geom_col(show.legend = FALSE) +
facet_wrap(~sentiment, scales = "free_y") +
labs(y = "Contribution to sentiment",
x = NULL) +
coord_flip()
library(wordcloud)
library(RColorBrewer)
tidy_song %>%
anti_join(stop_words) %>%
count(word) %>%
with(wordcloud(word, n, max.words = 100))
library(reshape2)
tidy_song %>%
inner_join(get_sentiments("bing")) %>%
count(word, sentiment, sort = TRUE) %>%
acast(word ~ sentiment, value.var = "n", fill = 0) %>%
comparison.cloud(colors = c("gray20", "gray80"),
max.words = 100)
library(sentimentr)
song_sentiment_sent <- wheredowego %>%
get_sentences() %>%
sentiment_by(by = c('track_title', 'line'))%>%
as.data.frame()
library(sentimentr)
song_sentiment_sent <- songsaboutjane %>%
get_sentences() %>%
sentiment_by(by = c('track_title', 'line'))%>%
as.data.frame()
library(sentimentr)
song_sentiment_sent <- songsaboutjane %>%
get_sentences() %>%
sentiment_by(by = c('track_title', 'line'))%>%
as.data.frame()
ggplot(song_sentiment_sent, aes(line, ave_sentiment, fill = track_title)) +
geom_col(show.legend = FALSE) +
facet_wrap(~track_title)
song_emotion <- songsaboutjane %>%
filter(track_title == "Harder to Breathe")%>%
get_sentences() %>%
emotion_by(by = c('track_title', 'line'))%>%
as.data.frame()
View(song_emotion)
View(afinn)
View(afinn)
tidy_song %>%
filter(track_title == "Harder to Breathe")%>%
inner_join(song_emotions) %>%
count(word, sort = TRUE)
tidy_song %>%
filter(track_title == "Harder to Breathe")%>%
inner_join(song_emotion) %>%
count(word, sort = TRUE)
song_sentiment <- tidy_song %>%
inner_join(get_sentiments("bing")) %>%
count(track_title, index = line, sentiment) %>%
spread(sentiment, n, fill = 0) %>%
mutate(sentiment = positive - negative)
song_sentiment <- tidy_song %>%
inner_join(get_sentiments("bing")) %>%
count(track_title, index = line, sentiment) %>%
spread(sentiment, n, fill = 0) %>%
mutate(sentiment = positive - negative)
setwd("~/Desktop/648/lab1/lab1")
setwd("~/Desktop/648/lab1/lab1")
setwd("~/Desktop/648/lab4")
library(readr)
library(dplyr)
library(stringr)
library(tidyr)
library(tidytext)
library(textdata)
library(tidyverse)
library(stringr)
library(purrr)
df <- read_csv("songs_about_jane.csv")
split_lyric_into_lines <- function(txt) {
if (is.na(txt) || txt == "") return(character(0))
# Split before capital letters, but only if preceded by space
parts <- str_split(
txt,
"\\s+(?=[A-Z])"
)[[1]]
parts <- str_trim(parts)
parts <- parts[parts != ""]
parts
}
df_lines <- df %>%
mutate(line_vec = map(lyric, split_lyric_into_lines)) %>%
select(track_title, track_n, line_vec) %>%
unnest_longer(line_vec, values_to = "lyric") %>%
group_by(track_title, track_n) %>%
mutate(line = row_number()) %>%
ungroup() %>%
select(track_title, track_n, line, lyric)
# Save as a new CSV
write_csv(df_lines, "songs_about_jane_lines.csv")
songsaboutjane <- read.csv("songs_about_jane_lines.csv")
nrc_anger <- get_sentiments("nrc") %>%
filter(sentiment == "anger")
nrc_anger
library(stringr)
## we need to make sure that the lyrics are characters
songsaboutjane$lyric <- as.character(songsaboutjane$lyric)
tidy_song <- songsaboutjane %>%
group_by(track_title) %>%
ungroup() %>%
unnest_tokens(word,lyric)
tidy_song %>%
filter(track_title == "Harder to Breathe")%>%
inner_join(nrc_anger) %>%
count(word, sort = TRUE)
song_sentiment <- tidy_song %>%
inner_join(get_sentiments("bing")) %>%
count(track_title, index = line, sentiment) %>%
spread(sentiment, n, fill = 0) %>%
mutate(sentiment = positive - negative)
ggplot(song_sentiment, aes(index, sentiment, fill = track_title)) +
geom_col(show.legend = FALSE) +
facet_wrap(~track_title)
afinn <- tidy_song %>%
filter(track_title == "Harder to Breathe") %>%
inner_join(get_sentiments("afinn")) %>%
group_by(index = line) %>%
summarise(sentiment = sum(value)) %>%
mutate(method = "AFINN")
bing_and_nrc <- bind_rows(tidy_song %>%
filter(track_title == "Harder to Breathe") %>%
inner_join(get_sentiments("bing")) %>%
mutate(method = "Bing et al."),
tidy_song %>%
filter(track_title == "Harder to Breathe") %>%
inner_join(get_sentiments("nrc") %>%
filter(sentiment %in% c("positive",
"negative"))) %>%
mutate(method = "NRC")) %>%
count(method, index = line, sentiment) %>%
spread(sentiment, n, fill = 0) %>%
mutate(sentiment = positive - negative)
bind_rows(afinn,
bing_and_nrc) %>%
ggplot(aes(index, sentiment, fill = method)) +
geom_col(show.legend = FALSE) +
facet_wrap(~method, ncol = 1, scales = "free_y")
get_sentiments("nrc") %>%
filter(sentiment %in% c("positive",
"negative")) %>%
count(sentiment)
get_sentiments("bing") %>%
count(sentiment)
bing_word_counts <- tidy_song %>%
inner_join(get_sentiments("bing")) %>%
count(word, sentiment, sort = TRUE) %>%
ungroup()
bing_word_counts
bing_word_counts %>%
group_by(sentiment) %>%
top_n(10) %>%
ungroup() %>%
mutate(word = reorder(word, n)) %>%
ggplot(aes(word, n, fill = sentiment)) +
geom_col(show.legend = FALSE) +
facet_wrap(~sentiment, scales = "free_y") +
labs(y = "Contribution to sentiment",
x = NULL) +
coord_flip()
library(wordcloud)
library(RColorBrewer)
tidy_song %>%
anti_join(stop_words) %>%
count(word) %>%
with(wordcloud(word, n, max.words = 100))
library(reshape2)
tidy_song %>%
inner_join(get_sentiments("bing")) %>%
count(word, sentiment, sort = TRUE) %>%
acast(word ~ sentiment, value.var = "n", fill = 0) %>%
comparison.cloud(colors = c("gray20", "gray80"),
max.words = 100)
library(sentimentr)
song_sentiment_sent <- songsaboutjane %>%
get_sentences() %>%
sentiment_by(by = c('track_title', 'line'))%>%
as.data.frame()
ggplot(song_sentiment_sent, aes(line, ave_sentiment, fill = track_title)) +
geom_col(show.legend = FALSE) +
facet_wrap(~track_title)
song_emotion <- songsaboutjane %>%
filter(track_title == "Harder to Breather")%>%
get_sentences() %>%
emotion_by(by = c('track_title', 'line'))%>%
as.data.frame()
library(readr)
library(dplyr)
library(stringr)
library(tidyr)
library(tidytext)
library(textdata)
library(tidyverse)
library(stringr)
library(purrr)
df <- read_csv("songs_about_jane.csv")
split_lyric_into_lines <- function(txt) {
if (is.na(txt) || txt == "") return(character(0))
# Split before capital letters, but only if preceded by space
parts <- str_split(
txt,
"\\s+(?=[A-Z])"
)[[1]]
parts <- str_trim(parts)
parts <- parts[parts != ""]
parts
}
df_lines <- df %>%
mutate(line_vec = map(lyric, split_lyric_into_lines)) %>%
select(track_title, track_n, line_vec) %>%
unnest_longer(line_vec, values_to = "lyric") %>%
group_by(track_title, track_n) %>%
mutate(line = row_number()) %>%
ungroup() %>%
select(track_title, track_n, line, lyric)
# Save as a new CSV
write_csv(df_lines, "songs_about_jane_lines.csv")
setwd("~/Desktop/skillbarter")
setwd("C:/Users/DeskS/OneDrive/Desktop/skillbarter/skillbarter")
